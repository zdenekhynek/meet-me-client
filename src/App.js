import React, { useState } from "react";
import "./App.css";

import Map from "./Map.js";

export const testLineString = [
  [51.5698237901, -0.09524228835],
  [51.56972240473, -0.09516502301],
  [51.56941288795, -0.09493265276],
  [51.56931263302, -0.09485026479],
  [51.56851223088, -0.09429211256],
  [51.56720279544, -0.09408971213],
  [51.56720279544, -0.09408971213],
  [51.56704276661, -0.09406497709],
  [51.56657406942, -0.09399800412],
  [51.56562253486, -0.09354722213],
  [51.5654771128, -0.09345230459],
  [51.56462278597, -0.09289647839],
  [51.56437462495, -0.09274091966],
  [51.56437462495, -0.09274091966],
  [51.56427755373, -0.09268007144],
  [51.56391411394, -0.09245000156],
  [51.56283652989, -0.09199012525],
  [51.5626014773, -0.09191339805],
  [51.56252002178, -0.09188647775],
  [51.56252002178, -0.09188647775],
  [51.56233024467, -0.09182375855],
  [51.56071910363, -0.09173250375],
  [51.56019742462, -0.09172548821],
  [51.55996119935, -0.09157668104],
  [51.55978358103, -0.09146286277],
  [51.55978358103, -0.09146286277],
  [51.55905247652, -0.09099437904],
  [51.55782946235, -0.09043969073],
  [51.55767669393, -0.09044608962],
  [51.55758636089, -0.090421021],
  [51.55713563419, -0.09035334406],
  [51.55689651447, -0.09032447724],
  [51.55689651447, -0.09032447724],
  [51.55598232734, -0.09021411796],
  [51.55576360362, -0.09003574747],
  [51.55566334538, -0.08995339424],
  [51.55511712149, -0.08954351618],
  [51.55489766647, -0.08936523628],
  [51.55489766647, -0.08936523628],
  [51.55454299794, -0.08907711627],
  [51.55443375268, -0.08899514394],
  [51.55393245743, -0.08858340452],
  [51.55362269323, -0.08833674192],
  [51.55331451771, -0.08806099066],
  [51.55331451771, -0.08806099066],
  [51.55312991227, -0.08789581026],
  [51.55278020666, -0.08740561287],
  [51.55255871254, -0.08650615583],
  [51.55241903891, -0.08614590237],
  [51.55241903891, -0.08614590237],
  [51.55223953764, -0.08568293077],
  [51.5521532504, -0.08535479118],
  [51.55209627401, -0.08516966609],
  [51.55204428362, -0.08473911714],
  [51.55188751501, -0.08450048776],
  [51.55164512276, -0.08458889405],
  [51.55164512276, -0.08458889405],
  [51.55099358572, -0.08482652032],
  [51.55089450048, -0.08481625778],
  [51.54917557782, -0.08438333924],
  [51.54917557782, -0.08438333924],
  [51.5489802147, -0.08433413813],
  [51.54861012647, -0.08424872105],
  [51.54697970662, -0.08382458594],
  [51.54697970662, -0.08382458594],
  [51.5469394115, -0.083814104],
  [51.54657878005, -0.08375714253],
  [51.54593034962, -0.08369785172],
  [51.54578609701, -0.08367506782],
  [51.54511945833, -0.08360212174],
  [51.54421119542, -0.08394115271],
  [51.54421119542, -0.08394115271],
  [51.54376981475, -0.08410590345],
  [51.54311757552, -0.08436404508],
  [51.54256347974, -0.08457479369],
  [51.54207556966, -0.08474391576],
  [51.54207556966, -0.08474391576],
  [51.54175870613, -0.08485374666],
  [51.54122258198, -0.08506372814],
  [51.54067794139, -0.0853029036],
  [51.54030183684, -0.0854419402],
  [51.54030183684, -0.0854419402],
  [51.53953379956, -0.08572585706],
  [51.53895297665, -0.08595211299],
  [51.53886334794, -0.08597029372],
  [51.53835394532, -0.08616470674],
  [51.53802675875, -0.08630422031],
  [51.53802675875, -0.08630422031],
  [51.5374162514, -0.08656453717],
  [51.53732351159, -0.08694334012],
  [51.53715365193, -0.08755608971],
  [51.53644900166, -0.08901315419],
  [51.53628530797, -0.08932278919],
  [51.53628530797, -0.08932278919],
  [51.5360826033, -0.08970621019],
  [51.53590217119, -0.08967050694],
  [51.53534555176, -0.08917472423],
  [51.53498140095, -0.08890159481],
  [51.53432592795, -0.08840997269],
  [51.53395413878, -0.08813661262],
];

export const createMarkerFromLatLng = (latLng) => {
  return { lat: latLng.lat(), lng: latLng.lng() };
};

function App() {
  const [markers, setMarkers] = useState([
    { lat: 51.5, lng: 0 },
    { lat: 51.55, lng: 0 },
  ]);

  const addMarker = (evt) => {
    const marker = createMarkerFromLatLng(evt.latLng);
    const newMarkers = [...markers, marker];
    setMarkers(newMarkers);
  };

  const onMarkerMove = (index, evt) => {
    const marker = createMarkerFromLatLng(evt.latLng);
    const newMarkers = [
      ...markers.slice(0, index),
      marker,
      ...markers.slice(index + 1),
    ];
    setMarkers(newMarkers);
  };

  const onMarkerRightClick = (index, evt) => {
    //  remove marker
    const newMarkers = [
      ...markers.slice(0, index),
      ...markers.slice(index + 1),
    ];
    setMarkers(newMarkers);
  };

  const mapProps = {
    markers,
    polylines: [testLineString],
    callbacks: {
      onDblClick: addMarker,
    },
    onMarkerRightClick,
    onMarkerMove,
  };

  return (
    <div className="App">
      <Map
        {...mapProps}
        googleMapURL={`https://maps.googleapis.com/maps/api/js?key=${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}&v=3.exp&libraries=geometry,drawing,places`}
        loadingElement={<div style={{ height: `100%` }} />}
        containerElement={<div style={{ height: `800px` }} />}
        mapElement={<div style={{ height: `100%` }} />}
      />
    </div>
  );
}

export default App;
